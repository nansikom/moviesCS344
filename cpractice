#include <stdio.h>
#include <stdlib.h>
#include <string.h>


    (void){
    char title[100];
    int choice;
    printf(" 1.Show movies released in the specified yea .\n");
    printf(" 2.Show highest rated movie for each year.\n");
    printf("3.Show the title and year of release of all movies in a specific language .\n");
    printf("4.Exit from the program .\n");
    printf(" Enter a choice from 1 to 4: .\n");
    scanf("%d", &choice);
    if (choice  == 1) {
        int year;
        printf("Enter the year for which you want to see the movie .\n");
        scanf("%d", &year);
    } else if (choice == 2 ) {
        int year;
        printf("Enter the year for which you want to see the highest rated movie .\n"); 
        scanf("%d", &year);
    } else if  (choice == 3) {
         char language[80];
         printf("Enter the year for which you want to see the movie .\n");
         scanf("%s", language);
    } else if (choice == 4){
            printf("Your out of the program");
    }
    const char *movie_file = "movies.csv";
    FILE* file  = fopen("movies.csv","r");
     if (file == NULL){
        printf("This file doesnt exist");
        return 1;
     }
    int moviecount;
    char buffer [1024];
    while (fgets (buffer, sizeof(buffer), file) != NULL){
        moviecount++;
    }
    fclose(file);
        
     
    
printf("Processed file %s and parsed data for %d movies \n",movie_file, moviecount);
return 0;
}


struct movie 
 {
    char* title;
    char*  year;
    char* language;
    char*  rate;
    struct movie *next;    

 };
 // dynamically allocating memmory on the heap for an individual movie sturct takes a pointer to the current line  
 //and uses a tokenizer to save the place where they stopped cutting the " " delimeters
 struct movie *createmovie( char *currline){
    struct movie *currmovie = malloc(sizeof (struct movie));
    char *saveptr;
    char *token = strtok_r(currline, " ", &saveptr);
    currmovie->title = calloc(strlen(token) + 1, sizeof(char));
    strcpy(currmovie->title, token);


    token = strtok_r(currline, " ", &saveptr);
    currmovie->year = calloc(strlen(token) + 1, sizeof(char));
    strcpy(currmovie->year, token);

    token = strtok_r(currline, " ", &saveptr);
    currmovie->language = calloc(strlen(token) + 1, sizeof(char));
    strcpy(currmovie->language, token);

    token = strtok_r(currline, "/n", &saveptr);
    currmovie->rate = calloc(strlen(token) + 1, sizeof(char));
    strcpy(currmovie->rate, token);
     currmovie->next = NULL;
     return currmovie;
 }
 
struct  movie *processFile(char * filepath){
    FILE *movieFile = fopen(filepath, "r");
    char *currline = NULL;
    size_t len = 0;

    size_t nread;
    char *token;
    //The head of the linked list
    struct movie * head = NULL;
    //the tail of the linked list
    struct movie *tail = NULL;


// Read the file line by line
    while ((nread = getline(&currline, &len, movieFile)) != -1)
    {
        struct movie *newNode = createmovie(currline);
        if (head == NULL){
            head = newNode;
            head = newNode;

        }
        else {
            tail->next = newNode;
            tail = newNode;

        }
    }
    free(currline);
    fclose(movieFile);
    return head;
}

/*
* Print data for the given student
*/
void printmovie(struct movie* amovie){
  printf("%s, %s %s, %s\n", amovie->title,
               amovie->year,
               amovie->language,
               amovie->rate);
}
/*
* Print the linked list of students
*/
void printmovielist(struct movie *list)
{
    while (list != NULL)
    {
        printmovie(list);
        list = list->next;
    }
}

/*
*   Process the file provided as an argument to the program to
*   create a linked list of student structs and print out the list.
*   Compile the program as follows:
*       gcc --std=gnu99 -o students main.c
*/
int main (int argc, char *argv[]){

    if (argc < 2)
    {
        printf("You must provide the name of the file to process\n");
        printf("Example usage: ./students student_info1.txt\n");
        return EXIT_FAILURE;
    }
    struct movie *list = processFile(argv[1]);
    printmovielist(list);
    return EXIT_SUCCESS;


    
    

 
}
    
